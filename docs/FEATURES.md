# 機能ドキュメント

このドキュメントでは、milistennaの各機能について詳しく説明します。

## 認証機能

### MiAuth認証

milistennaは、Misskeyの公式認証システムであるMiAuthを使用しています。

#### 認証フロー

1. **インスタンス入力**
   - ユーザーが接続したいMisskeyインスタンスのドメインを入力
   - ドメイン形式のバリデーション
   - インスタンスの存在確認

2. **MiAuthサポート確認**
   - `/api/endpoints`エンドポイントで`miauth/gen-token`の存在を確認
   - 非対応の場合はエラーメッセージを表示

3. **認証ページへのリダイレクト**
   - セッションID（UUID）を生成
   - 必要な権限を指定：
     - `read:account`: アカウント情報の読み取り
     - `write:account`: アカウント情報の変更
     - `read:following`: フォロー情報の読み取り
   - MiAuth URLに遷移

4. **トークン取得**
   - ユーザーが認証を許可
   - コールバックURLに戻る
   - `/api/miauth/{sessionId}/check`でトークンを取得

5. **セッション保存**
   - トークン、インスタンス情報、ユーザー情報をZustandストアに保存
   - ローカルストレージに永続化

#### セキュリティ

- トークンはローカルストレージに暗号化せずに保存（ブラウザのセキュリティに依存）
- HTTPS接続を推奨
- トークンの有効期限はMisskey側で管理

### ログアウト

- Zustandストアから認証情報を削除
- ローカルストレージからも削除
- ログインページにリダイレクト

## リスト管理機能

### リスト一覧

- ユーザーが作成したすべてのリストを表示
- 各リストカードに以下の情報を表示：
  - リスト名
  - メンバー数
  - 編集ボタン

### リスト作成

1. **モーダルを開く**
   - フローティングアクションボタン（FAB）をクリック

2. **リスト名入力**
   - リスト名を入力（必須）
   - バリデーション：
     - 1文字以上
     - 100文字以下

3. **作成実行**
   - `/api/users/lists/create`エンドポイントを呼び出し
   - 成功時にリスト一覧を自動更新

### リスト編集

#### リスト名の変更

- リスト名を編集
- `/api/users/lists/update`で更新

#### メンバー管理

1. **ユーザー検索**
   - ユーザー名またはホスト名で検索
   - デバウンス処理により、入力中の無駄なAPI呼び出しを防止
   - `/api/users/search-by-username-and-host`を使用

2. **ユーザー追加**
   - 検索結果からユーザーを選択
   - モーダルで確認
   - `/api/users/lists/push`で追加

3. **ユーザー削除**
   - リストから削除したいユーザーを選択
   - 確認モーダルを表示
   - `/api/users/lists/pull`で削除

### リスト削除

1. 削除ボタンをクリック
2. 確認モーダルを表示
3. `/api/users/lists/delete`で削除
4. リスト一覧に戻る

## アンテナ管理機能

### アンテナ一覧

- ユーザーが作成したすべてのアンテナを表示
- 各アンテナカードに以下の情報を表示：
  - アンテナ名
  - ソース種別
  - 編集ボタン

### アンテナ作成

1. **モーダルを開く**
   - フローティングアクションボタン（FAB）をクリック
   - 作成ページに遷移

2. **基本情報入力**
   - アンテナ名（必須）
   - ソース選択：
     - ホーム
     - すべての投稿
     - 指定したユーザーの投稿
     - 指定したユーザーを除いたすべて
     - 指定したリスト

3. **詳細設定**
   - キーワード設定（含めるキーワード、除外するキーワード）
   - 対象ユーザー（ソースが「指定したユーザー」の場合）
   - 対象リスト（ソースが「指定したリスト」の場合）
   - その他のオプション：
     - CWの投稿を除外
     - ファイル付き投稿のみ
     - 返信を除外

4. **作成実行**
   - `/api/antennas/create`エンドポイントを呼び出し
   - 成功時にアンテナ一覧に戻る

### アンテナ編集

- 作成時と同様の画面で編集
- `/api/antennas/update`で更新
- すべての設定項目を変更可能

### アンテナ削除

1. 削除ボタンをクリック
2. 確認モーダルを表示
3. `/api/antennas/delete`で削除
4. アンテナ一覧に戻る

## ソース種別の詳細

### ホーム
- フォローしているユーザーの投稿を対象

### すべての投稿
- インスタンス内のすべての公開投稿を対象

### 指定したユーザーの投稿
- 特定のユーザーの投稿のみを対象
- 複数ユーザーの指定が可能

### 指定したユーザーを除いたすべて
- 特定のユーザーを除いたすべての投稿を対象
- ブラックリスト機能

### 指定したリスト
- 事前に作成したリストのメンバーの投稿を対象

## UI/UX機能

### レスポンシブデザイン
- モバイル、タブレット、デスクトップに対応
- グリッドレイアウトが画面サイズに応じて調整

### カラーモード
- ライトモード
- ダークモード
- システム設定に従う

### ローディング状態
- データ取得中にローディングインジケータを表示
- スケルトンスクリーンによる滑らかなUX

### エラーハンドリング
- API エラー時にエラーメッセージを表示
- ネットワークエラーの検出
- 適切なフィードバック

### 楽観的更新
- ユーザーアクションの即座の反映
- バックグラウンドでのAPI呼び出し
- エラー時のロールバック

## データ管理

### キャッシング
- TanStack Queryによる自動キャッシング
- スマートな再取得戦略
- バックグラウンド更新

### 状態の永続化
- ログイン状態のローカルストレージ保存
- ページリロード後も状態を維持

## パフォーマンス

### 遅延ローディング
- ルートごとのコード分割
- 必要に応じた動的インポート

### デバウンス処理
- ユーザー検索時の無駄なAPI呼び出しを防止
- 500msのデバウンス時間

### メモ化
- React Compilerによる自動最適化
- 不要な再レンダリングの防止
